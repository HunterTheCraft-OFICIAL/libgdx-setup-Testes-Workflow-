name: 'libGDX Project Factory'

# Este workflow permite gerar estruturas de projeto libGDX prÃ©-configuradas
# diretamente pela interface do GitHub Actions (aba Actions).
on:
  workflow_dispatch:
    inputs:
      project_name:
        description: 'Application Name (e.g., MySuperGame)'
        required: true
        default: 'MyGdxGame'
      package_name:
        description: 'Java Package (e.g., com.mycompany.game)'
        required: true
        default: 'com.mygdx.game'
      selected_variant:
        description: 'Select a specific variant (or "all" for everything)'
        type: choice
        default: 'all'
        options:
          - all
          - desktop-only
          - mobile-basic
          - web-starter
          - physics-2d-basic
          - physics-3d-pro
          - ui-heavy-suite
          - ecs-core-ashley
          - smart-logic-ai
          - full-platform-stack
          - creative-sandbox
          - all-all

jobs:
  factory:
    name: 'Build Project Variants'
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Set up JDK 8
        uses: actions/setup-java@v4
        with:
          java-version: '8'
          distribution: 'temurin'
          # Cache automÃ¡tico para dependÃªncias do Gradle para acelerar builds futuros
          cache: 'gradle'

      - name: ðŸ”¨ Compile Setup Engine
        run: |
          mkdir -p bin
          javac -cp publish/gdx-setup.jar -d bin $(find src -name "*.java")

      - name: âš™ï¸ Generate Projects
        run: |
          # Garante que o diretÃ³rio de saÃ­da esteja limpo
          mkdir -p dist
          
          # Se 'all' for selecionado, iteramos por todas as 11 variantes do catÃ¡logo
          if [ "${{ github.event.inputs.selected_variant }}" == "all" ]; then
            variants=("desktop-only" "mobile-basic" "web-starter" "physics-2d-basic" "physics-3d-pro" "ui-heavy-suite" "ecs-core-ashley" "smart-logic-ai" "full-platform-stack" "creative-sandbox" "all-all")
            for v in "${variants[@]}"; do
              echo "Factory: Generating $v..."
              java -cp publish/gdx-setup.jar:bin com.badlogic.gdx.setup.HeadlessSetup \
                --variant $v \
                --dir "dist/$v" \
                --name "${{ github.event.inputs.project_name }}_$v" \
                --package "${{ github.event.inputs.package_name }}"
            done
          else
            # Gera apenas a variante especÃ­fica selecionada no dropdown
            v="${{ github.event.inputs.selected_variant }}"
            echo "Factory: Generating single variant: $v"
            java -cp publish/gdx-setup.jar:bin com.badlogic.gdx.setup.HeadlessSetup \
              --variant $v \
              --dir "dist/$v" \
              --name "${{ github.event.inputs.project_name }}" \
              --package "${{ github.event.inputs.package_name }}"
          fi

      - name: ðŸ“Š Generation Report
        if: always()
        run: |
          echo "### ðŸ› ï¸ Factory Generation Report" >> $GITHUB_STEP_SUMMARY
          echo "**Project Name:** ${{ github.event.inputs.project_name }}" >> $GITHUB_STEP_SUMMARY
          echo "**Package:** ${{ github.event.inputs.package_name }}" >> $GITHUB_STEP_SUMMARY
          echo "**Strategy:** ${{ github.event.inputs.selected_variant }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Directory | Status |" >> $GITHUB_STEP_SUMMARY
          echo "| :--- | :--- |" >> $GITHUB_STEP_SUMMARY
          if [ -d "dist" ]; then
            cd dist && for d in *; do echo "| $d | âœ… Generated |" >> $GITHUB_STEP_SUMMARY; done
          else
            echo "| N/A | âŒ Generation Failed |" >> $GITHUB_STEP_SUMMARY
          fi

      - name: ðŸ“¦ Archiving Artifacts
        if: success()
        uses: actions/upload-artifact@v4
        with:
          name: ${{ github.event.inputs.project_name }}-variants
          path: dist/
