name: Generate libGDX Project Variants

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  setup:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up JDK 8
      uses: actions/setup-java@v3
      with:
        java-version: '8'
        distribution: 'temurin'

    - name: Compile setup package
      run: |
        echo "CLASSPATH: publish/gdx-setup.jar"
        javac -cp publish/gdx-setup.jar $(find src/com/badlogic/gdx/setup -name "*.java")

    # Variante BÃ¡sica
    - name: Run HeadlessSetup (Basic)
      run: |
        java -cp publish/gdx-setup.jar:src com.badlogic.gdx.setup.HeadlessSetup --mode basic --dir MyGdxBasic --name MyGdxBasic --package com.mygdx.basic --mainClass BasicMain
        mkdir -p output
        cd MyGdxBasic
        zip -r ../output/libgdx-basic.zip .
        cd ..

    # Variante Completa
    - name: Run HeadlessSetup (All)
      run: |
        java -cp publish/gdx-setup.jar:src com.badlogic.gdx.setup.HeadlessSetup --mode all --dir MyGdxAll --name MyGdxAll --package com.mygdx.all --mainClass AllMain
        mkdir -p output
        cd MyGdxAll
        zip -r ../output/libgdx-all.zip .
        cd ..

    # Variante Personalizada (teste)
    - name: Run HeadlessSetup (Custom Test)
      run: |
        java -cp publish/gdx-setup.jar:src com.badlogic.gdx.setup.HeadlessSetup \
          --mode custom \
          --dir libGDX-teste \
          --name libGDX-teste \
          --package com.mygdx.teste \
          --mainClass TesteMain \
          --language java \
          --addModules desktop;android \
          --addExtensions box2d;ashley
        mkdir -p output
        cd libGDX-teste
        zip -r ../output/libgdx-teste.zip .
        cd ..

    # Artefato final com todas as variantes
    - name: Package all variants together
      run: |
        mkdir -p output/final
        cp output/libgdx-basic.zip output/final/
        cp output/libgdx-all.zip output/final/
        cp output/libgdx-teste.zip output/final/
        cd output/final
        zip -r ../output/libgdx-all-variants.zip .
        cd ../..

    # Upload individual artefacts
    - name: Upload Basic ZIP
      uses: actions/upload-artifact@v4
      with:
        name: libgdx-basic
        path: output/libgdx-basic.zip

    - name: Upload All ZIP
      uses: actions/upload-artifact@v4
      with:
        name: libgdx-all
        path: output/libgdx-all.zip

    - name: Upload Test ZIP
      uses: actions/upload-artifact@v4
      with:
        name: libgdx-teste
        path: output/libgdx-teste.zip

    # Upload final combined artefact
    - name: Upload All Variants ZIP
      uses: actions/upload-artifact@v4
      with:
        name: libgdx-all-variants
        path: output/libgdx-all-variants.zip