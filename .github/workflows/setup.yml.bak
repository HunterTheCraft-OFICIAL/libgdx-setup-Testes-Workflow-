name: Generate libGDX Project Variants

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  build-sequencial:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    - name: Set up JDK 8
      uses: actions/setup-java@v3
      with:
        java-version: '8'
        distribution: 'temurin'

    - name: Compile Setup Package
      run: |
        javac -cp publish/gdx-setup.jar $(find src/com/badlogic/gdx/setup -name "*.java")

    # Criamos um arquivo para armazenar o resumo
    - name: Init Summary
      run: echo "# üìä Resumo da Execu√ß√£o" > summary.md

    # BLOCO DE EXECU√á√ÉO EM LINHA
    # Repita este padr√£o para cada variante que deseja no fluxo
    - name: Variant: only-desktop-basic
      continue-on-error: true # Permite que o fluxo continue mesmo se uma falha
      run: |
        if java -cp publish/gdx-setup.jar:src com.badlogic.gdx.setup.HeadlessSetup --variant only-desktop-basic --dir out-desktop --name DesktopGame; then
          echo "- ‚úÖ only-desktop-basic: SUCESSO" >> summary.md
        else
          echo "- ‚ùå only-desktop-basic: FALHOU" >> summary.md
          exit 1
        fi

    - name: Variant: desktop-box2d-freetype
      continue-on-error: true
      run: |
        if java -cp publish/gdx-setup.jar:src com.badlogic.gdx.setup.HeadlessSetup --variant desktop-box2d-freetype --dir out-box2d --name Box2DGame; then
          echo "- ‚úÖ desktop-box2d-freetype: SUCESSO" >> summary.md
        else
          echo "- ‚ùå desktop-box2d-freetype: FALHOU" >> summary.md
          exit 1
        fi

    # ... Adicione as outras variantes aqui seguindo o mesmo padr√£o ...

    # RESUMO FINAL NO JOB SUMMARY
    - name: Publish Summary
      if: always()
      run: cat summary.md >> $GITHUB_STEP_SUMMARY

    - name: Upload Artifacts
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: all-variants-bundle
        path: out-* # Sobe todas as pastas que come√ßam com out-
