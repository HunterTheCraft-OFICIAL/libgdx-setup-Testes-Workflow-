name: 'libGDX Project Factory'

on:
  workflow_dispatch:
    inputs:
      project_name:
        description: 'Nome do Aplicativo'
        required: true
        default: 'MyGdxGame'
      package_name:
        description: 'Pacote Java'
        required: true
        default: 'com.mygdx.game'
      generate_all:
        description: 'Gerar todas as variantes do catÃ¡logo?'
        type: boolean
        default: true

jobs:
  factory:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up JDK 8
        uses: actions/setup-java@v4
        with:
          java-version: '8'
          distribution: 'temurin'
          cache: 'gradle' # Ativa cache automÃ¡tico para dependÃªncias do Gradle

      - name: ðŸ”¨ Compile Setup Engine
        run: |
          mkdir -p bin
          javac -cp publish/gdx-setup.jar -d bin $(find src -name "*.java")

      - name: âš™ï¸ Generate Projects
        run: |
          # Se 'generate_all' for true, percorre o catÃ¡logo. 
          # Caso contrÃ¡rio, gera apenas a padrÃ£o.
          if [ "${{ github.event.inputs.generate_all }}" == "true" ]; then
            variants=("only-desktop-basic" "only-android-basic" "mobile-basic" "desktop-box2d-freetype" "desktop-ashley-ai" "all-all")
            for v in "${variants[@]}"; do
              java -cp publish/gdx-setup.jar:bin com.badlogic.gdx.setup.HeadlessSetup \
                --variant $v \
                --dir "dist/$v" \
                --name "${{ github.event.inputs.project_name }}_$v"
            done
          else
            java -cp publish/gdx-setup.jar:bin com.badlogic.gdx.setup.HeadlessSetup \
              --variant only-desktop-basic \
              --dir "dist/default" \
              --name "${{ github.event.inputs.project_name }}"
          fi

      - name: ðŸ“Š Generation Report
        if: always()
        run: |
          echo "### ðŸ› ï¸ RelatÃ³rio de FÃ¡brica" >> $GITHUB_STEP_SUMMARY
          echo "**Projeto:** ${{ github.event.inputs.project_name }}" >> $GITHUB_STEP_SUMMARY
          echo "**Pacote:** ${{ github.event.inputs.package_name }}" >> $GITHUB_STEP_SUMMARY
          echo "| Pasta | Status |" >> $GITHUB_STEP_SUMMARY
          echo "| :--- | :--- |" >> $GITHUB_STEP_SUMMARY
          cd dist && for d in *; do echo "| $d | âœ… Gerado |" >> $GITHUB_STEP_SUMMARY; done

      - name: ðŸ“¦ Archiving Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: ${{ github.event.inputs.project_name }}-variants
          path: dist/