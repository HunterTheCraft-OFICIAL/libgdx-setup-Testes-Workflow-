name: Generate libGDX Project Variants

on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  generate-all:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up JDK 8
        uses: actions/setup-java@v3
        with:
          java-version: '8'
          distribution: 'temurin'

      - name: Compile Setup Package
        run: |
          # Garante que as classes compiladas fiquem no diretÃ³rio bin para o classpath
          mkdir -p bin
          javac -cp publish/gdx-setup.jar -d bin $(find src/com/badlogic/gdx/setup -name "*.java")

      - name: Initialize Summary
        run: echo "### ðŸ“Š Resumo das Variantes" >> $GITHUB_STEP_SUMMARY

      # --- BLOCO: only-desktop-basic ---
      - name: Build only-desktop-basic
        id: variant_1
        continue-on-error: true
        run: |
          java -cp publish/gdx-setup.jar:bin com.badlogic.gdx.setup.HeadlessSetup \
            --variant only-desktop-basic --dir out-desktop --name DesktopGame
          echo "VAR_1_STATUS=success" >> $GITHUB_ENV
      
      - name: Upload only-desktop-basic
        if: steps.variant_1.outcome == 'success'
        uses: actions/upload-artifact@v4
        with:
          name: only-desktop-basic
          path: out-desktop/

      - name: Log only-desktop-basic Result
        if: always()
        run: |
          if [ "${{ steps.variant_1.outcome }}" == "success" ]; then
            echo "- âœ… only-desktop-basic: SUCESSO" >> $GITHUB_STEP_SUMMARY
          else
            echo "- âŒ only-desktop-basic: FALHOU" >> $GITHUB_STEP_SUMMARY
          fi

      # --- BLOCO: desktop-box2d-freetype ---
      - name: Build desktop-box2d-freetype
        id: variant_2
        continue-on-error: true
        run: |
          java -cp publish/gdx-setup.jar:bin com.badlogic.gdx.setup.HeadlessSetup \
            --variant desktop-box2d-freetype --dir out-box2d --name Box2DGame
      
      - name: Upload desktop-box2d-freetype
        if: steps.variant_2.outcome == 'success'
        uses: actions/upload-artifact@v4
        with:
          name: desktop-box2d-freetype
          path: out-box2d/

      - name: Log desktop-box2d-freetype Result
        if: always()
        run: |
          if [ "${{ steps.variant_2.outcome }}" == "success" ]; then
            echo "- âœ… desktop-box2d-freetype: SUCESSO" >> $GITHUB_STEP_SUMMARY
          else
            echo "- âŒ desktop-box2d-freetype: FALHOU" >> $GITHUB_STEP_SUMMARY
          fi

      # --- BLOCO: all-all ---
      - name: Build all-all
        id: variant_3
        continue-on-error: true
        run: |
          java -cp publish/gdx-setup.jar:bin com.badlogic.gdx.setup.HeadlessSetup \
            --variant all-all --dir out-all --name FullGame
      
      - name: Upload all-all
        if: steps.variant_3.outcome == 'success'
        uses: actions/upload-artifact@v4
        with:
          name: all-all
          path: out-all/

      - name: Log all-all Result
        if: always()
        run: |
          if [ "${{ steps.variant_3.outcome }}" == "success" ]; then
            echo "- âœ… all-all: SUCESSO" >> $GITHUB_STEP_SUMMARY
          else
            echo "- âŒ all-all: FALHOU" >> $GITHUB_STEP_SUMMARY
          fi
